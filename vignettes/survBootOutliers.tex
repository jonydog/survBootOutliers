\documentclass{article}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\usepackage{Sweave}
\begin{document}
\input{survBootOutliers-concordance}

\title{survBootOutliers: An R package for outlier detection in survival analysis}
\author{Jo<U+00E3>o Diogo Pinto, joao.pinto@tecnico.ulisboa.pt}

\maketitle

\tableofcontents

\section{Introduction}
This  package provides three new outlier detection methods to perform outlier detection in a survival analysis context. The first  method OSD, for One Step Deletion, is a sequential procedure that maximizes the c-index of a fitted Cox regression using a a greedy one-step-ahead search, in each step the observation that when removed maximizes the concordance increase is permanently deleted from the dataset, the algorithm ends until k observations are removed, these are considered the most outlying ones. The second and third methods are based on bootstrap methods. The second method BHT, for Bootstrap Hypothesis Testing, is based on creating B bootstrap samples for each observation that is removed from the dataset, then an hypothesis test is made for the B concordance variations to be larger than zero, the observations with the lowest p-values are considered the most outlying. The last method DBHT, for Dual Bootstrap Hypothesis Testing, draws 2B bootstrap samples for each observation, B samples with each observation absent, just like with BHT, the other B bootstrap samples are drawn with the observation under test being deliberately inserted in each of the bootstrap samples. The hypothesis test is different, the two histograms are tested for inequality, for non-outlying observations the histograms are expected to be similar but for outlying observtions the histograms drawn when the observation is absent is expected to have higher concordance on average.

The package still provides three other methods considered more traditional based on Martingale-based residuals, Deviancre resiudals and Cox likelihood displacement.

These methods are based on the Master Thesis at Instituto Superior T<U+00E9>cnico, named "Outlier detection in survival analysis" evaluated in May 2015. The link for the full text is left here for more detail:  \href{https://fenix.tecnico.ulisboa.pt/downloadFile/844820067124612/dissertacao.pdf}.

\section{Example data}
The well-known Worcester Heart Attack Study data is given as example and provided within the package;

\begin{Schunk}
\begin{Sinput}
> library(survBootOutliers)
> whas100_data <-  get.whas100.dataset()
> summary(whas100_data)
\end{Sinput}
\begin{Soutput}
       X               los             age            gender    
 Min.   :  1.00   Min.   : 1.00   Min.   :32.00   Min.   :0.00  
 1st Qu.: 25.75   1st Qu.: 4.00   1st Qu.:59.75   1st Qu.:0.00  
 Median : 50.50   Median : 5.00   Median :71.00   Median :0.00  
 Mean   : 50.50   Mean   : 6.84   Mean   :68.25   Mean   :0.35  
 3rd Qu.: 75.25   3rd Qu.: 7.00   3rd Qu.:80.25   3rd Qu.:1.00  
 Max.   :100.00   Max.   :56.00   Max.   :92.00   Max.   :1.00  
      bmi            times          status    
 Min.   :14.92   Min.   :   6   Min.   :0.00  
 1st Qu.:23.54   1st Qu.: 715   1st Qu.:0.00  
 Median :27.19   Median :1878   Median :1.00  
 Mean   :27.04   Mean   :1505   Mean   :0.51  
 3rd Qu.:30.35   3rd Qu.:2076   3rd Qu.:1.00  
 Max.   :39.94   Max.   :2719   Max.   :1.00  
\end{Soutput}
\end{Schunk}

\section{Examples}

\subsection{OSD}

\begin{Schunk}
\begin{Sinput}
> whas <- get.whas100.dataset()
> outliers_osd <- survBootOutliers( 
+     surv.object=Surv(time = whas$times,event = whas$status ),
+     covariate.data = whas[,2:5] , sod.method = "osd",
+     max.outliers = 10 )
> print(outliers_osd)
\end{Sinput}
\begin{Soutput}
   removed_indexes
1                1
2               67
3               97
4               51
5               23
6               31
7               93
8               52
9               56
10              57
\end{Soutput}
\end{Schunk}

\subsection{BHT}

\begin{Schunk}
\begin{Sinput}
> whas <- get.whas100.dataset()
> outliers_bht <- survBootOutliers( 
+     surv.object=Surv(time = whas$times,event = whas$status ),
+     covariate.data = whas[,2:5],
+     sod.method = "bht",
+     B = 100,
+     B.N = 100,
+     parallel.param = SnowParam() )
> print(outliers_bht)
\end{Sinput}
\begin{Soutput}
       obs_id   avg_delta  max_delta pvalue
  [1,]     72 0.027611475 0.10807723   0.21
  [2,]      1 0.027287592 0.12757797   0.26
  [3,]      7 0.016715848 0.09698777   0.26
  [4,]     27 0.019061102 0.09174737   0.28
  [5,]     26 0.019173832 0.10314902   0.29
  [6,]     51 0.021513399 0.10537945   0.29
  [7,]     56 0.017274224 0.11068718   0.29
  [8,]     13 0.017665596 0.08097828   0.30
  [9,]     19 0.014012947 0.09490600   0.30
 [10,]     48 0.013431113 0.11020049   0.30
 [11,]     24 0.016869547 0.09338036   0.31
 [12,]     32 0.014865121 0.10417174   0.31
 [13,]     38 0.014072482 0.09129301   0.31
 [14,]     41 0.010551774 0.10054448   0.31
 [15,]     89 0.019987832 0.13236890   0.31
 [16,]     93 0.018257633 0.11743887   0.31
 [17,]      5 0.013536380 0.08345236   0.32
 [18,]     17 0.015785723 0.12127324   0.32
 [19,]     29 0.016638932 0.10153128   0.32
 [20,]     33 0.013927619 0.10612963   0.32
 [21,]     52 0.016582226 0.09794922   0.32
 [22,]     81 0.018580690 0.10722641   0.32
 [23,]      3 0.015072574 0.08520625   0.33
 [24,]     36 0.017060615 0.13111850   0.33
 [25,]     67 0.020421006 0.11485555   0.33
 [26,]      8 0.014790732 0.10294827   0.34
 [27,]      9 0.014731455 0.09816310   0.34
 [28,]     23 0.013892425 0.10401136   0.34
 [29,]     31 0.018352804 0.12578076   0.34
 [30,]     40 0.014318530 0.09960823   0.34
 [31,]     47 0.013265559 0.09126976   0.34
 [32,]     55 0.011399950 0.10138000   0.34
 [33,]     71 0.016700631 0.10411137   0.34
 [34,]    100 0.014813884 0.09861668   0.34
 [35,]     69 0.013463565 0.09944927   0.35
 [36,]     79 0.011420209 0.10392855   0.35
 [37,]     82 0.012686447 0.11514753   0.35
 [38,]     88 0.016459524 0.09219357   0.35
 [39,]      6 0.015836999 0.10386576   0.36
 [40,]     10 0.011969183 0.07978838   0.36
 [41,]     11 0.012733059 0.08786030   0.36
 [42,]     30 0.019162776 0.10641884   0.36
 [43,]     49 0.013542176 0.09425278   0.36
 [44,]     94 0.011618831 0.08894430   0.36
 [45,]     97 0.015414896 0.08586268   0.36
 [46,]     35 0.008587719 0.08202889   0.37
 [47,]     50 0.013812102 0.09355730   0.37
 [48,]     58 0.011742399 0.09743354   0.37
 [49,]     84 0.012341732 0.11954180   0.37
 [50,]     34 0.013352467 0.10592296   0.38
 [51,]     70 0.006403374 0.08625027   0.38
 [52,]     73 0.011129416 0.12530105   0.38
 [53,]     77 0.008821478 0.09925672   0.38
 [54,]     80 0.011977382 0.10093236   0.38
 [55,]     85 0.012368895 0.11007857   0.38
 [56,]     86 0.010202018 0.10210319   0.38
 [57,]     91 0.013178677 0.10874534   0.38
 [58,]     21 0.011642453 0.10843147   0.39
 [59,]     37 0.010700658 0.10147777   0.39
 [60,]     39 0.009389516 0.10110173   0.39
 [61,]     45 0.009212052 0.09439134   0.39
 [62,]     62 0.011213720 0.10723242   0.39
 [63,]     65 0.011324764 0.11124941   0.39
 [64,]      4 0.011548395 0.11804135   0.40
 [65,]     20 0.008491088 0.09141833   0.40
 [66,]     46 0.013656798 0.10538887   0.40
 [67,]     57 0.011462055 0.12175076   0.40
 [68,]     96 0.011166414 0.11691075   0.40
 [69,]      2 0.008480437 0.10236794   0.41
 [70,]     14 0.011402667 0.10890126   0.41
 [71,]     16 0.007968214 0.08461779   0.41
 [72,]     18 0.005567021 0.11442624   0.41
 [73,]     25 0.009271540 0.07597854   0.41
 [74,]     54 0.008957388 0.16963627   0.41
 [75,]     76 0.011913040 0.08438865   0.41
 [76,]     78 0.015289854 0.09246464   0.41
 [77,]     87 0.007152698 0.10520347   0.41
 [78,]     90 0.011944431 0.09594185   0.41
 [79,]     95 0.004399914 0.09262176   0.41
 [80,]     12 0.011366120 0.12171878   0.42
 [81,]     44 0.010482061 0.10940590   0.42
 [82,]     60 0.011630469 0.09297173   0.42
 [83,]     61 0.010578990 0.10205268   0.43
 [84,]     63 0.004717494 0.10831817   0.43
 [85,]     15 0.006653430 0.10238251   0.44
 [86,]     28 0.007222064 0.08586469   0.44
 [87,]     75 0.008335320 0.10277642   0.44
 [88,]     92 0.008051093 0.09577644   0.44
 [89,]     22 0.008359211 0.08444371   0.45
 [90,]     68 0.007927632 0.14415603   0.45
 [91,]     83 0.003459704 0.07848356   0.46
 [92,]     98 0.004671777 0.07623242   0.46
 [93,]     42 0.005166476 0.09122081   0.47
 [94,]     59 0.004282994 0.06753474   0.47
 [95,]     64 0.005690477 0.11453354   0.47
 [96,]     66 0.003275029 0.09106414   0.47
 [97,]     43 0.003441847 0.09400519   0.50
 [98,]     53 0.005564772 0.09194036   0.50
 [99,]     74 0.006249643 0.10390031   0.50
[100,]     99 0.002706195 0.08967388   0.50
\end{Soutput}
\end{Schunk}

\subsection{DBHT}

\begin{Schunk}
\begin{Sinput}
> whas <- get.whas100.dataset()
> outliers_dbht <- survBootOutliers( 
+     surv.object=Surv(time = whas$times,event = whas$status ),
+     covariate.data = whas[,2:5],
+     sod.method = "dbht",
+     B = 100,
+     B.N = 100,
+     parallel.param = SnowParam() )
> print(outliers_dbht)
\end{Sinput}
\begin{Soutput}
       obs_id       pvalue
  [1,]      1 4.205759e-08
  [2,]     97 2.777949e-06
  [3,]     32 6.309168e-05
  [4,]     33 9.924673e-04
  [5,]     69 1.623067e-03
  [6,]     67 2.236985e-03
  [7,]     57 2.660440e-03
  [8,]     31 3.725087e-03
  [9,]     17 3.786154e-03
 [10,]     29 3.927600e-03
 [11,]     82 4.654132e-03
 [12,]      7 5.521754e-03
 [13,]     56 1.816454e-02
 [14,]     93 2.055192e-02
 [15,]     78 3.418365e-02
 [16,]     80 8.111716e-02
 [17,]     51 8.430645e-02
 [18,]     90 9.163080e-02
 [19,]     27 1.011789e-01
 [20,]     52 1.384487e-01
 [21,]     46 1.421134e-01
 [22,]     94 1.455978e-01
 [23,]     25 1.457590e-01
 [24,]      5 2.116774e-01
 [25,]     45 2.237595e-01
 [26,]      3 2.256183e-01
 [27,]     23 2.484419e-01
 [28,]     10 2.927643e-01
 [29,]     89 3.097673e-01
 [30,]     44 3.141523e-01
 [31,]     11 3.252411e-01
 [32,]     47 3.255484e-01
 [33,]     76 3.581578e-01
 [34,]     24 3.588315e-01
 [35,]     49 4.062571e-01
 [36,]     91 4.185767e-01
 [37,]     77 4.490437e-01
 [38,]     71 4.538221e-01
 [39,]     81 4.565789e-01
 [40,]     79 4.594587e-01
 [41,]     48 4.599184e-01
 [42,]     83 4.643887e-01
 [43,]     22 4.652386e-01
 [44,]      9 4.874025e-01
 [45,]      8 4.998887e-01
 [46,]     75 5.071451e-01
 [47,]     13 5.099577e-01
 [48,]      6 5.416744e-01
 [49,]     26 5.443534e-01
 [50,]     28 5.564387e-01
 [51,]     53 5.862295e-01
 [52,]     40 6.104588e-01
 [53,]     30 6.232562e-01
 [54,]     88 6.232737e-01
 [55,]     18 6.304466e-01
 [56,]     84 6.336439e-01
 [57,]     36 6.609233e-01
 [58,]     72 6.638452e-01
 [59,]     19 6.813379e-01
 [60,]     92 6.831323e-01
 [61,]     68 6.864638e-01
 [62,]     55 7.012841e-01
 [63,]     74 7.373425e-01
 [64,]     63 7.608480e-01
 [65,]    100 7.626392e-01
 [66,]     58 7.719350e-01
 [67,]     62 7.960073e-01
 [68,]     21 7.978898e-01
 [69,]     41 8.064281e-01
 [70,]     59 8.160723e-01
 [71,]     54 8.228540e-01
 [72,]     15 8.240065e-01
 [73,]     86 8.467867e-01
 [74,]     42 8.487130e-01
 [75,]     37 8.769855e-01
 [76,]     50 8.873631e-01
 [77,]     38 8.905304e-01
 [78,]     85 9.101319e-01
 [79,]      4 9.209403e-01
 [80,]     70 9.308094e-01
 [81,]     65 9.350723e-01
 [82,]     60 9.438807e-01
 [83,]     39 9.445810e-01
 [84,]     12 9.479843e-01
 [85,]     87 9.524251e-01
 [86,]     20 9.559585e-01
 [87,]     98 9.599148e-01
 [88,]     16 9.617403e-01
 [89,]     61 9.624572e-01
 [90,]      2 9.629279e-01
 [91,]     66 9.680013e-01
 [92,]     96 9.680948e-01
 [93,]     64 9.719358e-01
 [94,]     99 9.768894e-01
 [95,]     35 9.790913e-01
 [96,]     34 9.851908e-01
 [97,]     43 9.873165e-01
 [98,]     95 9.952362e-01
 [99,]     14 9.963323e-01
[100,]     73 9.979709e-01
\end{Soutput}
\end{Schunk}



\end{document}
